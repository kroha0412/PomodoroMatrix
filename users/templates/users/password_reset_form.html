<!-- users/templates/users/password_reset_form.html -->
<!-- Шаблон для формы восстановления пароля -->
<!-- Наследуем базовый шаблон для страниц восстановления пароля -->
{% extends 'users/password_reset_base.html' %}

<!-- Блок заголовка страницы (тег <title>) -->
{% block reset_title %}Восстановление пароля{% endblock %}

<!-- Блок основного заголовка на странице -->
{% block reset_header %}
    <!-- Проверяем валидность ссылки для сброса пароля -->
    {% if validlink %}
        <!-- Если ссылка действительна - показываем форму ввода нового пароля -->
        Введите новый пароль
    {% else %}
        <!-- Если ссылка недействительна -->
        {% if form.email %}
            <!-- Если есть поле email - это начальная форма запроса сброса -->
            Восстановление пароля
        {% else %}
            <!-- Если нет поля email - это страница с ошибкой невалидной ссылки -->
            Недействительная ссылка
        {% endif %}
    {% endif %}
{% endblock %}

<!-- Блок подзаголовка/пояснения на странице -->
{% block reset_subtitle %}
    {% if validlink %}
        <!-- Инструкция для формы ввода нового пароля -->
        Введите новый пароль для вашего аккаунта
    {% else %}
        {% if form.email %}
            <!-- Инструкция для начальной формы запроса сброса -->
            Введите ваш email для получения инструкций
        {% else %}
            <!-- Сообщение об ошибке для недействительной ссылки -->
            Ссылка для восстановления недействительна
        {% endif %}
    {% endif %}
{% endblock %}

<!-- Основной блок контента страницы -->
{% block reset_content %}
    <!-- Если ссылка валидна - показываем форму ввода нового пароля -->
    {% if validlink %}
        <!-- Форма ввода нового пароля -->
        <form method="POST" class="auth-form">
            <!-- Защита от CSRF атак -->
            {% csrf_token %}

            <!-- Поле для нового пароля -->
            <div class="form-group">
                <label>Новый пароль</label>
                <!--
                    name="new_password1" - стандартное имя для первого поля пароля в Django
                    type="password" - скрывает вводимые символы
                    required - обязательное поле
                -->
                <input type="password" name="new_password1" class="form-control" required>
                <!-- Вывод ошибок валидации для нового пароля -->
                {% if form.new_password1.errors %}
                <div class="field-errors">
                    <!-- Перебираем все ошибки поля нового пароля -->
                    {% for error in form.new_password1.errors %}
                    <span class="error">{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Поле для подтверждения пароля -->
            <div class="form-group">
                <label>Подтвердите пароль</label>
                <!--
                    name="new_password2" - стандартное имя для подтверждения пароля в Django
                    Проверяет, что оба поля пароля совпадают
                -->
                <input type="password" name="new_password2" class="form-control" required>
                <!-- Вывод ошибок валидации для подтверждения пароля -->
                {% if form.new_password2.errors %}
                <div class="field-errors">
                    {% for error in form.new_password2.errors %}
                    <span class="error">{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Кнопка для сохранения нового пароля -->
            <button type="submit" class="btn btn-primary btn-full">Сохранить пароль</button>
        </form>

    <!-- Если ссылка невалидна, но есть поле email - это начальная форма -->
    {% elif form.email %}
        <!-- Форма запроса email для отправки ссылки сброса -->
        <form method="POST" class="auth-form">
            {% csrf_token %}

            <!-- Поле для ввода email -->
            <div class="form-group">
                <label>Email адрес</label>
                <!--
                    Поле для ввода email пользователя
                    На этот email будет отправлена ссылка для сброса пароля
                -->
                <input type="email" name="email" class="form-control" required>
                <!-- Ошибки валидации email обрабатываются через messages или non_field_errors -->
            </div>

            <!-- Кнопка для отправки инструкций на email -->
            <button type="submit" class="btn btn-primary btn-full">Отправить инструкции</button>
        </form>

    <!-- Если ссылка невалидна и нет поля email - показываем сообщение об ошибке -->
    {% else %}
        <!-- Сообщение о недействительной ссылке -->
        <div class="alert alert-error">
            Ссылка для восстановления пароля недействительна или устарела.
        </div>
        <!-- Дополнительные ссылки для пользователя -->
        <div class="auth-links">
            <!-- Ссылка для запроса новой ссылки восстановления -->
            <p><a href="{% url 'users:password_reset' %}">Запросить новую ссылку</a></p>
        </div>
    {% endif %}
{% endblock %}