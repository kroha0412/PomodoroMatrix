# Импортируем модуль администрирования Django
from django.contrib import admin

# Импортируем модель ProductivityStats из текущего приложения analytics
from .models import ProductivityStats


# Создаем класс для настройки отображения статистики продуктивности в админке
class ProductivityStatsAdmin(admin.ModelAdmin):
    """
    Админка для статистики - только для просмотра системной аналитики
    Статистика генерируется автоматически и не должна изменяться вручную
    """

    # list_display - определяет ключевые поля для отображения в списке статистики
    # Показываем самые важные метрики для быстрого обзора
    list_display = ('user', 'date', 'total_pomodoros_completed', 'total_tasks_completed', 'productivity_score')

    # list_filter - добавляет фильтр по дате для анализа трендов во времени
    # Можно смотреть статистику за конкретные дни, недели, месяцы
    list_filter = ('date',)

    # search_fields - добавляет поиск по имени пользователя
    # Админ может найти статистику конкретного пользователя
    search_fields = ('user__username',)

    # readonly_fields - ВСЕ поля статистики только для чтения
    # Статистика вычисляется автоматически и не должна меняться вручную
    readonly_fields = (
        'user',  # Пользователь (чья статистика)
        'date',  # Дата статистики (за какой день)
        'total_pomodoros_completed',  # Общее количество завершенных Pomodoro сессий
        'total_tasks_completed',  # Количество завершенных задач
        'time_spent_per_quadrant',  # Распределение времени по квадрантам матрицы Эйзенхауэра
        'quadrant_2_time',  # Время, потраченное на важные несрочные задачи (самый продуктивный квадрант)
        'planned_pomodoros',  # Запланированное количество Pomodoro сессий
        'completed_on_time_tasks',  # Задачи выполненные в срок
        'focus_score',  # Оценка фокуса (насколько хорошо пользователь концентрировался)
        'productivity_score',  # Общая оценка продуктивности (главный показатель)
        'interruptions_count'  # Количество прерываний во время работы
    )

    # Запрещаем добавление новой статистики через админку
    def has_add_permission(self, request):
        """
        Возвращает False чтобы скрыть кнопку "Добавить"
        Статистика должна генерироваться только автоматически системой
        """
        return False

    # Запрещаем редактирование существующей статистики
    def has_change_permission(self, request, obj=None):
        """
        Возвращает False чтобы убрать возможность редактирования
        Исторические данные статистики не должны изменяться - это исказит аналитику
        """
        return False

    # Запрещаем удаление статистики
    def has_delete_permission(self, request, obj=None):
        """
        Возвращает False чтобы запретить удаление статистики
        Сохраняем исторические данные для долгосрочного анализа трендов
        """
        return False


# Регистрируем модель ProductivityStats с настройками ProductivityStatsAdmin
# Теперь статистика продуктивности будет отображаться в админке с защитой от изменений
admin.site.register(ProductivityStats, ProductivityStatsAdmin)