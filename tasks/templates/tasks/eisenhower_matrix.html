<!-- tasks/templates/tasks/eisenhower_matrix.html -->
{% extends 'core/base.html' %}
{% load static %}
{% load tasks_extras %}

{% block title %}–ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞ - MatrixPomodoro{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'tasks/css/matrix.css' %}">
{% endblock %}

{% block content %}
<div class="matrix-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="matrix-header">
        <h1>–ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞</h1>
        <p>–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏ –ø–æ —á–µ—Ç—ã—Ä–µ–º –∫–≤–∞–¥—Ä–∞–Ω—Ç–∞–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤</p>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ -->
    <div class="task-create-section">
        <button class="btn btn-primary" id="show-task-form-btn">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
        </button>

        <div class="task-form-container" id="task-form-container" style="display: none;">
            <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h3>
            <form id="task-form" method="POST" action="{% url 'tasks:create_task' %}">
                {% csrf_token %}
                <div class="form-grid">
                    <div class="form-group">
                        <label for="{{ task_form.title.id_for_label }}">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                        {{ task_form.title }}
                    </div>

                    <div class="form-group">
                        <label for="{{ task_form.quadrant.id_for_label }}">–ö–≤–∞–¥—Ä–∞–Ω—Ç *</label>
                        {{ task_form.quadrant }}
                    </div>

                    <div class="form-group">
                        <label for="{{ task_form.priority.id_for_label }}">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-10)</label>
                        {{ task_form.priority }}
                    </div>

                    <div class="form-group">
                        <label for="{{ task_form.estimated_pomodoros.id_for_label }}">Pomodoro</label>
                        {{ task_form.estimated_pomodoros }}
                    </div>

                    <div class="form-group full-width">
                        <label for="{{ task_form.description.id_for_label }}">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        {{ task_form.description }}
                    </div>

                    <div class="form-group">
                        <label for="{{ task_form.due_date.id_for_label }}">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                        {{ task_form.due_date }}
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
                    <button type="button" class="btn btn-outline" id="cancel-task-form">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ -->
    <div class="eisenhower-matrix">
        {% for quadrant in quadrants %}
        <div class="quadrant" data-quadrant-id="{{ quadrant.id }}" style="border-color: {{ quadrant.color_code }};">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–≤–∞–¥—Ä–∞–Ω—Ç–∞ -->
            <div class="quadrant-header" style="background: {{ quadrant.color_code }};">
                <h3>{{ quadrant.name }}</h3>
                <p class="quadrant-description">{{ quadrant.description }}</p>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–¥–∞—á -->
            <div class="tasks-container" id="quadrant-{{ quadrant.id }}">
                {% for task in tasks_by_quadrant|get_item:quadrant.id %}
                <div class="task-card" data-task-id="{{ task.id }}" draggable="true">
                    <div class="task-header">
                        <h4 class="task-title">{{ task.title }}</h4>
                        <div class="task-actions">
                            <button class="btn-edit" data-task-id="{{ task.id }}">‚úèÔ∏è</button>
                            <button class="btn-delete" data-task-id="{{ task.id }}">üóëÔ∏è</button>
                            <button class="btn-complete" data-task-id="{{ task.id }}">‚úÖ</button>
                        </div>
                    </div>

                    {% if task.description %}
                    <p class="task-description">{{ task.description }}</p>
                    {% endif %}

                    <div class="task-meta">
                        <span class="task-priority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {{ task.priority }}</span>
                        <span class="task-pomodoros">üçÖ {{ task.estimated_pomodoros }}</span>
                        {% if task.due_date %}
                        <span class="task-due-date">üìÖ {{ task.due_date|date:"d.m.Y H:i" }}</span>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ –∑–∞–¥–∞—á–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
<div class="modal" id="edit-task-modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É</h3>
        <form id="edit-task-form">
            {% csrf_token %}
            <input type="hidden" id="edit-task-id" name="task_id">
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
                <input type="text" id="edit-task-title" class="form-control" required>
            </div>
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="edit-task-description" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>–ö–≤–∞–¥—Ä–∞–Ω—Ç</label>
                    <select id="edit-task-quadrant" class="form-control">
                        {% for quadrant in quadrants %}
                        <option value="{{ quadrant.id }}">{{ quadrant.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <input type="number" id="edit-task-priority" class="form-control" min="1" max="10">
                </div>
                <div class="form-group">
                    <label>Pomodoro</label>
                    <input type="number" id="edit-task-pomodoros" class="form-control" min="1" max="20">
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="btn btn-outline" id="cancel-edit">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'tasks/js/dragdrop.js' %}"></script>
<script src="{% static 'tasks/js/tasks.js' %}"></script>
<script src="{% static 'tasks/js/matrix.js' %}"></script>
{% endblock %}